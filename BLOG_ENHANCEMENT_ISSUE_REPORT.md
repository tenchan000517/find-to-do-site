# 🚨 ブログ生成システム修正依頼書

**作成日**: 2025年6月22日  
**担当**: Claude Code  
**次回担当者**: [新しいエンジニア名]  
**緊急度**: 高  

## 📋 今回の実装内容（Phase 3+拡張）

### 実装した機能
1. **ソース記載機能**: Google Newsから情報源を取得し、記事末尾に「参考文献・情報源」セクションを追加
2. **SEO最適化機能**: フロントマターに詳細なSEOメタデータを自動生成
3. **品質向上**: 関連ニュース数増加（2→3件）、トークン制限拡大（1500-4000→3500-6000）

### 修正したファイル
- `src/lib/prompt.ts`: プロンプト構造を大幅変更
- `src/lib/trends.ts`: ソース情報取得機能追加
- `src/lib/article.ts`: SEOメタデータ生成機能追加

## 🚨 発見された問題点

### 1. **参考文献セクションが生成されない**
**問題**: プロンプトで指示しているが、実際の記事に「参考文献・情報源」セクションが含まれていない
- 原因推測: トークン制限により記事が途中で切れている
- 影響: 情報源の明記ができず、記事の信頼性が低下

### 2. **SEO過度最適化による記事構造破綻**
**問題**: 記事内に不適切な「キーワード」セクションが挿入されている
```markdown
**キーワード:** ロボットプログラミング, こくり, 小牧市, プログラミングワークショップ, TypeScript, React...
```
- これは記事コンテンツとして不自然
- SEOメタデータはフロントマターのみに含めるべき

### 3. **記事構成の変更による従来構造の破綻**
**問題**: 以前の自然な記事構成が「導入部」「背景・概要」などの見出しに変わった

**以前の構造（推測）**:
```markdown
# タイトル

自然な導入文...

## 主要なポイント1
## 主要なポイント2
## まとめ
```

**現在の構造（問題あり）**:
```markdown
# タイトル

**導入部**
導入文...

## 背景・概要
**キーワード:** [大量のキーワード列挙]

## 主要なポイント1：詳細なサブタイトル
```

### 4. **不適切なコード強制挿入**
**問題**: ニュース記事なのにプログラミングコードが必須となっている
- 「小牧市ロボットワークショップ」→TypeScript/Reactコード挿入
- トピックと技術スタックが不一致

## 📝 修正が必要な具体的変更点

### A. プロンプト構造の問題（`src/lib/prompt.ts`）

**問題のある変更**:
```typescript
// 現在の問題のあるプロンプト構造
## 記事構成
1. **タイトル** (# で始まる見出し) - SEO最適化されたインパクトのあるタイトル
2. **導入部** (300-400文字) - 読者の課題や関心を引き、主要キーワードを自然に含める
3. **背景・概要** (## 見出し、600-800文字) - トピックの重要性と現状、関連キーワード含有
...
9. **参考文献・情報源** (## 見出し) - 記事作成に使用した情報源とURL
```

**修正すべき点**:
1. 「導入部」「背景・概要」を見出しとして強制しない
2. SEO要件を記事内容に混入させない
3. 自然な記事構成に戻す
4. カテゴリに応じたコード挿入の可否判断

### B. SEOメタデータの問題（`src/lib/article.ts`）

**問題のある変更**:
```typescript
// フロントマターが複雑になりすぎている
keywords: ["プログラミング","コード","開発","エンジニア","ソフトウェア","ロボットプログラミング入門：小牧市「こくり」を動かす最新手法","2025年版"]
wordCount: 8627
readingTime: 15
seo:
  metaTitle: "..."
  metaDescription: "..."
  canonicalUrl: "/blog/プログラミング/-2025-1750574282774"  // slugに問題
```

**修正すべき点**:
1. キーワードを記事内に露出させない
2. slug生成の修正（空のタイトルによる異常なslug）
3. フロントマターの簡素化

### C. 参考文献セクションの問題

**現在の実装**:
```typescript
## 参考文献・情報源セクション（必須）
記事の最後に以下の形式で参考文献セクションを作成してください：

${sourceReferences}
```

**問題**:
1. トークン制限により実際に生成されない
2. プロンプトの優先度が低い

## 🎯 修正指示

### 優先度1: プロンプト構造の正常化
1. **自然な記事構成に戻す**
   - 「導入部」「背景・概要」を見出しとして強制しない
   - 自然な段落構成を許可
   - カテゴリに応じた適切な構成を提案

2. **SEO要件の分離**
   - 記事内容からSEO要件を除去
   - フロントマターのみでSEO対応

### 優先度2: 参考文献セクション確実生成
1. **プロンプト優先度の調整**
   - 参考文献セクションを必須として最優先に設定
   - トークン制限を考慮した構成

2. **簡潔な参考文献形式**
   ```markdown
   ## 参考情報
   - [ニュースタイトル] - ソース名
   - Google News検索結果
   ```

### 優先度3: カテゴリ適応性の改善
1. **コード挿入の条件分岐**
   - プログラミング/ウェブ開発: コード例推奨
   - AI技術: 必要に応じてコード
   - キャリア/ビジネス: コード不要

2. **トピック適合性チェック**
   - ニュース内容と技術要素の整合性確認

## 📋 期待される修正後の記事構造

```markdown
---
title: "自然なタイトル"
date: "2025-06-22T06:38:02.775Z"
category: "カテゴリ"
slug: "proper-slug"
excerpt: "自然な抜粋..."
keywords: ["適切なキーワード"]
---

# 自然なタイトル

自然な導入段落...

## 適切な見出し1

内容...

## 適切な見出し2

内容...

## まとめ

まとめ...

## 参考情報

- [ニュースタイトル] - ソース名
- Google News検索: [URL]
```

## 🚀 修正開始コマンド

```bash
# プロジェクトに移動
cd /mnt/c/find-to-do-site

# 主な修正対象ファイル
# 1. src/lib/prompt.ts - プロンプト構造の正常化
# 2. src/lib/article.ts - SEOメタデータ簡素化
# 3. テスト生成で動作確認

# 問題のある生成ファイル削除
rm content/blog/プログラミング/2025-06-22--2025-1750574282774.md
```

## 📞 連絡事項

- 今回の機能追加自体（ソース記載、SEO最適化）は有効
- 実装方法に問題があるため修正が必要
- Phase 3の目標（5000-7000文字、高品質）は継続
- 既存機能（RSS更新など）は維持

---

**重要**: この修正により、より自然で読みやすく、かつSEO最適化された記事生成が可能になります。